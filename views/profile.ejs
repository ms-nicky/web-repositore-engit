<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/profile.css">
</head>
<body class="<%= bgmode === 'white' ? 'white-content' : '' %>">
<script>
// Persist white-content mode across pages
document.addEventListener('DOMContentLoaded', function() {
    if (localStorage.getItem('whiteContent') === 'true') {
        document.body.classList.add('white-content');
    } else {
        document.body.classList.remove('white-content');
    }
});
</script>
<div class="container">
    <a href="/docs" class="back-button">&lt;</a> 
    <div class="card" id="profilePictureCard">
        <h2>Profile Picture</h2>
        <div class="profile-header">
            <div class="profile-img-placeholder">
                <% if (user.profilePic) { %>
                  <img src="<%= user.profilePic %>" alt="Profile" style="width:50px;height:50px;border-radius:50%;object-fit:cover;">
                <% } else { %>
                  <img src="" alt="Default" style="width:50px;height:50px;border-radius:50%;object-fit:cover;">
                <% } %>
            </div>
            <div class="profile-info">
                <strong><%= user.username %></strong>
                <span><%= user.email %></span>
            </div>
        </div>
        <form id="uploadForm" enctype="multipart/form-data" method="POST" action="/profile/upload-photo">
        <div class="file-upload-wrapper">
            <label for="file-upload" class="custom-file-upload btn-grey">
                Pilih File
            </label>
            <input id="file-upload" name="profilePic" type="file" accept="image/*">
            <span class="file-name" id="selectedFileName">Tidak ada file yang dipilih</span>
        </div>
        <div class="button-group" style="justify-content: flex-end;"> 
            <button class="btn-blue" type="submit">Upload</button>
        </div>
        </form>
    </div>
    <div class="card" id="detailProfileCard">
        <h2>Detail Profile</h2>
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" value="<%= user.username %>" class="input-readonly" readonly>
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" value="<%= user.email %>" class="input-readonly" readonly>
        </div>
        <div class="form-group">
            <label for="apikey">Apikey</label>
            <input type="text" id="apikey" value="<%= user.apikey %>" class="input-readonly" readonly>
        </div>
    <% if (user.role === 'premium' || user.role === 'owner') { %>
        <div class="form-group">
            <label for="custom-apikey">Custom Apikey</label>
            <form id="customApikeyForm" method="POST" action="/profile/custom-apikey">
                <input type="text" id="custom-apikey" name="customApikey" placeholder="Enter your custom apikey" maxlength="32" required>
                <button class="btn-blue" type="submit">Set Custom Apikey</button>
            </form>
        </div>
        <% } %>
        <div class="form-group">
            <label for="account-type">Account type</label>
            <input type="text" id="account-type" value="<%= user.accountType === 'Owner' ? 'Owner (∞)' : user.accountType %>" class="input-readonly" readonly>
        </div>
        <div class="form-group">
            <label for="remaining-limit">Remaining limit today</label>
            <input type="text" id="remaining-limit" value="<%= user.accountType === 'Owner' ? '∞' : user.limit %>" class="input-readonly" readonly>
        </div>
        <div class="form-group">
            <label for="expired-at">Expired At</label>
            <input type="text" id="expired-at" value="<%= user.expiredAt %>" class="status-red input-readonly" readonly>
        </div>
    </div>
    <div class="card" id="changePasswordCard">
        <h2>Change Password</h2>
        <form id="changePasswordForm" method="POST" action="/profile/change-password">
        <div class="form-group">
            <label for="old-password">Old Password</label>
            <input type="password" id="old-password" name="oldPassword">
        </div>
        <div class="form-group">
            <label for="new-password">New Password</label>
            <input type="password" id="new-password" name="newPassword">
        </div>
        <div class="form-group">
            <label for="confirm-new-password">Confirm New Password</label>
            <input type="password" id="confirm-new-password" name="confirmNewPassword">
        </div>
        <button class="btn-blue" type="submit">Change Password</button>
        </form>
    </div>
    <div class="card" id="changeEmailCard">
        <h2>Change Email</h2>
        <form id="changeEmailForm" method="POST" action="/profile/change-email">
        <div class="form-group">
            <label for="old-email">Old Email</label>
            <input type="email" id="old-email" name="oldEmail" value="<%= user.email %>" class="input-readonly" readonly>
        </div>
        <div class="form-group">
            <label for="new-email">New Email</label>
            <input type="email" id="new-email" name="newEmail">
        </div>
        <button class="btn-blue" type="submit">Change Email</button>
        </form>
    </div>
    <div class="footer">
        Copyright NICKY || 2024 - 2025
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('file-upload');
        const fileNameDisplay = document.getElementById('selectedFileName');
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'Tidak ada file yang dipilih';
            }
        });
    });
</script>
</body>
</html>
